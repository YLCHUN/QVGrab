# QVGrab

QVGrab是一个iOS视频抓取工具，通过WebKit智能嗅探网页视频资源，支持M3U8流媒体解析下载、Blob URL处理、多格式视频下载和断点续传功能。

## 功能特性

- 🔍 **智能视频嗅探** - 自动检测网页中的视频资源
- 📱 **M3U8解析下载** - 支持HLS流媒体格式的完整下载
- 🌐 **Blob URL支持** - 支持现代网页中的Blob对象视频资源
- 🎬 **MP4格式支持** - 支持MP4、WebM等常见视频格式
- 🔐 **加密内容支持** - 内置解密器，支持AES-128等加密方式
- 📊 **多码率支持** - 自动选择最佳画质进行下载
- 🎯 **广告过滤** - 智能识别并过滤广告片段
- 💾 **断点续传** - 支持下载中断后的续传功能

## 核心架构

### 视频嗅探模块

QVGrab采用基于WebKit的智能嗅探技术，通过注入JavaScript脚本实时监控网页中的媒体资源：

- **实时监控**：监听网络请求和DOM变化
- **智能识别**：自动识别视频、音频等媒体元素
- **多源支持**：支持iframe、embed等多种嵌入方式
- **动态检测**：适应SPA应用的动态内容加载

### M3U8解析下载模块

内置完整的M3U8播放列表解析器，支持：

- **格式解析**：完整解析M3U8文件结构
- **片段管理**：自动处理TS片段下载队列
- **加密解密**：支持AES-128等标准加密方式
- **多码率处理**：自动选择最佳画质流
- **直播支持**：实时处理直播流更新

## 技术实现

### 视频嗅探原理

1. **WebView注入**：在WKWebView中注入监控脚本
2. **网络拦截**：监控所有网络请求，识别媒体资源
3. **DOM分析**：分析页面结构，查找视频元素
4. **动态检测**：监听页面变化，实时发现新内容
5. **Blob处理**：支持Blob URL的创建和下载
6. **格式识别**：自动识别MP4、WebM等视频格式

### M3U8下载流程

1. **解析播放列表**：解析M3U8文件，提取片段信息
2. **密钥获取**：下载并缓存解密密钥
3. **并发下载**：多线程并发下载TS片段
4. **解密处理**：实时解密加密的媒体片段
5. **文件合并**：按序合并片段，生成完整视频

## 使用方法

### 基本使用

1. 启动应用，输入目标网页地址
2. 等待页面加载完成，系统自动开始嗅探
3. 发现视频资源后，点击下载按钮
4. 选择下载质量和保存位置
5. 开始下载，支持后台运行

### 高级功能

- **批量下载**：支持同时下载多个视频
- **画质选择**：自动选择下载最高画质
- **格式转换**：支持多种视频格式的自动识别
- **Blob下载**：支持Blob URL视频的完整下载
- **下载管理**：查看下载进度和历史记录
- **文件管理**：支持重命名、删除等操作

## 技术特点

- **高效解析**：优化的M3U8解析算法，支持大型播放列表
- **多格式支持**：支持M3U8、MP4、WebM、Blob等多种格式
- **缓存机制**：多级别缓存机制，避免重复下载
- **内存优化**：流式处理，减少内存占用
- **错误恢复**：自动重试机制，提高下载成功率
- **Blob处理**：高效的Blob对象处理和URL转换

## 注意事项

- 请遵守相关法律法规和网站使用条款
- 仅用于个人学习和合法用途
- 部分网站可能有反爬虫机制
- 建议在WiFi环境下使用，避免流量消耗
- ffmpeg-ios 获取仓库：`git@github.com:YLCHUN/ffmpeg-ios.git`

## 贡献

欢迎提交Issue和Pull Request来改进项目。

---

*QVGrab - 让视频下载更简单*
